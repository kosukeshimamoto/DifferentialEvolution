# agents.md

## 目的（Goal）
Julia で「小さく、信頼でき、再現可能」な差分進化系最適化パッケージを作る。アルゴリズムの網羅より、使いやすさ・再現性・品質保証を優先する。

## 完了条件（Definition of Done）
- Julia >= 1.10 で `Pkg.test()` が通る
- 明示的に渡した `rng` によって結果が再現できる（テストで確認）
- README に最小例があり、コピペで動く
- 公開 API（関数名、主要キーワード、戻り値 `Result` の主要フィールド）が安定している
- box 境界を常に守る（テストで確認）

## スコープ（v1）
### 含める（IN）
- 連続変数の最小化
- box 制約（下限・上限）
- 入口関数は 1 つ（例：`optimize`）
- `Result`（best 解、目的値、停止理由、評価回数、反復回数、最小限の履歴）

### 含めない（OUT）
- 並列/分散、GPU
- 整数・混合整数
- 一般制約（box 以外）
- 多目的最適化
- 大規模な機能追加（自動チューニング等）

## 設計原則（Design Principles）
- 正しさと再現性を最優先（性能はその次）
- 依存は最小（stdlib 優先）
- グローバル RNG を使わず、`rng` を必ず引数で受けて内部に伝搬する
- API を小さく一貫させ、不要な機能追加を避ける
- 破壊的変更を避ける（必要なら deprecation 方針を明記）

## テスト方針（Testing）
- 乱数を使うテストは seed 固定で再現性を担保する
- 最低限：再現性、境界、入力検証、簡単な sanity テスト（ベンチ関数等）
- CI を想定して、閾値は保守的にし flake を避ける

## 実装・ドキュメント規約（Coding/Docs）
- 公開 API と内部実装を分離する
- 公開関数には docstring を付ける
- 反復内アロケーションは可能な範囲で避ける（ただし可読性と正しさ優先）
- README に引数、戻り値、停止理由、再現性の説明を入れる

## 作業手順（Workflow）
- 変更は小さく積む（実装 + テスト + README/doc を同じ変更に含める）
- ユーザーに見える挙動が変わる場合は、先に README/仕様を更新してからコードを変える
- v1 スコープ外の機能追加は行わない（明示的な指示がある場合を除く）

## 判断ルール（Decision Policy）
- 迷ったら「最小・保守的・テストで担保しやすい」案を選ぶ
- 推測で機能を増やさない
- 外部互換（Optim.jl 等）を狙う場合は互換レベルを宣言し、それ以上は目指さない